<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>simpleMap</title>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script
	src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=l7xxce3558ee38884b2da0da786de609a5be"></script>
<script type="text/javascript">
	var map;
	var markerLayer;
	var markerLayer2;
	//경로를 그려줄 레이어
	var routeLayer;
	var prtcl;
	//교통정보를 그려줄 레이어
	var vectorLayer;
	//출발지,도착지 마커
	var marker_s, marekr_e;
	//경로그림정보
	var drawInfoArr = [];
	var resultInfoArr1 = [];
	var resultInfoArr2 = [];
	var resultInfoArr3 = [];

	var defaultRouteResult;

    var startX = '127.370187';
    var startY = '36.334634';
    var stopover1X = '127.147333';
    var stopover1Y = '36.809299';
    var stopover2X = null;
    var stopover2Y = '37.145916';
    var finishX = '127.043625';
    var finishY = '37.280209';

	stopover2X = '127.066912';

	function initTmap() {
		// 1. 지도 띄우기
		map = new Tmapv2.Map("map_div", {
			center : new Tmapv2.LatLng(startY, startX),
			width : "100%",
			height : "400px",
			zoom : 11,
			zoomControl : true,
			scrollwheel : true

		});

		// 2. 시작, 도착 심볼찍기
		// 시작
		marker_s = new Tmapv2.Marker(
				{
					position : new Tmapv2.LatLng(127.370187, 36.334634),
					icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
					iconSize : new Tmapv2.Size(48, 72),
					map : map
				});

		// 도착
		marker_e = new Tmapv2.Marker(
				{
					position : new Tmapv2.LatLng(stopover1X, stopover1Y),
					icon : "http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
					iconSize : new Tmapv2.Size(24, 38),
					map : map
				});

		$(function(){
			var searchOption = $("#selectLevel").val();																	
					$
								.ajax({
									method : "POST",
									url : "https://apis.openapi.sk.com/tmap/truck/routes?version=1&format=json&callback=result",//
									async : false,
									data : {
										"appKey" : "l7xxce3558ee38884b2da0da786de609a5be",
										"startX" : startX,
										"startY" : startY,
										"endX" : stopover1X,
										"endY" : stopover1Y,
										"reqCoordType" : "WGS84GEO",
										"resCoordType" : "EPSG3857",
										"angle" : "172",
										"searchOption" : searchOption,
										"trafficInfo" : "Y",
										"truckType" : "1",
										"truckWidth" : "100",
										"truckHeight" : "100",
										"truckWeight" : "35000",
										"truckTotalWeight" : "35000",
										"truckLength" : "200"
									},
									success : function(response) {
										// 결과 출력
										var resultData = response.features;

										var tDistance = "총 거리 : "
												+ (resultData[0].properties.totalDistance / 1000)
														.toFixed(1)
												+ "km,";
										var tTime = " 총 시간 : "
												+ (resultData[0].properties.totalTime / 60)
														.toFixed(0)
												+ "분,";
										var tFare = " 총 요금 : "
												+ resultData[0].properties.totalFare
												+ "원,";
										var taxiFare = " 예상 택시 요금 : "
												+ resultData[0].properties.taxiFare
												+ "원";

										$("#result")
												.html();

										if (resultInfoArr1.length > 0) {
											for (var k = 0; k < resultInfoArr1.length; k++) {
												resultInfoArr1[k]
														.setMap(null);
											}
										}
										resultInfoArr1 = [];

										for ( var i in resultData) { //for문 [S]
											var geometry = resultData[i].geometry;
											var properties = resultData[i].properties;
											var polyline_;

											drawInfoArr = [];

											if (geometry.type == "LineString") {
												for ( var j in geometry.coordinates) {
													// 경로들의 결과값(구간)들을 포인트 객체로 변환 
													var latlng = new Tmapv2.Point(
															geometry.coordinates[j][0],
															geometry.coordinates[j][1]);
													// 포인트 객체를 받아 좌표값으로 변환
													var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
															latlng);
													// 포인트객체의 정보로 좌표값 변환 객체로 저장
													var convertChange = new Tmapv2.LatLng(
															convertPoint._lat,
															convertPoint._lng);
													// 배열에 담기
													drawInfoArr
															.push(convertChange);
												}

												polyline_ = new Tmapv2.Polyline(
														{
															path : drawInfoArr,
															strokeColor : "#FF0000", //RED
															strokeWeight : 6,
															map : map
														});
												resultInfoArr1
														.push(polyline_);
											}
										}//for문 [E]
									},
									error : function(request,
											status, error) {
										console
												.log("code:"
														+ request.status
														+ "\n"
														+ "message:"
														+ request.responseText
														+ "\n"
														+ "error:"
														+ error);
									}
								});
		});


		$(function(){
			var searchOption = $("#selectLevel").val();
			$
				.ajax({
					method : "POST",
					url : "https://apis.openapi.sk.com/tmap/truck/routes?version=1&format=json&callback=result",//
					async : false,
					data : {
						"appKey" : "l7xxce3558ee38884b2da0da786de609a5be",
						"startX" : stopover1X,
						"startY" : stopover1Y,
						"endX" : stopover2X,
						"endY" : stopover2Y,
						"reqCoordType" : "WGS84GEO",
						"resCoordType" : "EPSG3857",
						"angle" : "172",
						"searchOption" : searchOption,
						"trafficInfo" : "Y",
						"truckType" : "1",
						"truckWidth" : "100",
						"truckHeight" : "100",
						"truckWeight" : "35000",
						"truckTotalWeight" : "35000",
						"truckLength" : "200"
					},
					success : function(response) {
						// 결과 출력
						var resultData = response.features;

						var tDistance = "총 거리 : "
								+ (resultData[0].properties.totalDistance / 1000)
										.toFixed(1)
								+ "km,";
						var tTime = " 총 시간 : "
								+ (resultData[0].properties.totalTime / 60)
										.toFixed(0)
								+ "분,";
						var tFare = " 총 요금 : "
								+ resultData[0].properties.totalFare
								+ "원,";
						var taxiFare = " 예상 택시 요금 : "
								+ resultData[0].properties.taxiFare
								+ "원";

						$("#result")
								.html();

						if (resultInfoArr2.length > 0) {
							for (var k = 0; k < resultInfoArr2.length; k++) {
								resultInfoArr2[k]
										.setMap(null);
							}
						}
						resultInfoArr2 = [];

						for ( var i in resultData) { //for문 [S]
							var geometry = resultData[i].geometry;
							var properties = resultData[i].properties;
							var polyline_;

							drawInfoArr = [];

							if (geometry.type == "LineString") {
								for ( var j in geometry.coordinates) {
									// 경로들의 결과값(구간)들을 포인트 객체로 변환 
									var latlng = new Tmapv2.Point(
											geometry.coordinates[j][0],
											geometry.coordinates[j][1]);
									// 포인트 객체를 받아 좌표값으로 변환
									var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
											latlng);
									// 포인트객체의 정보로 좌표값 변환 객체로 저장
									var convertChange = new Tmapv2.LatLng(
											convertPoint._lat,
											convertPoint._lng);
									// 배열에 담기
									drawInfoArr
											.push(convertChange);
								}

								polyline_ = new Tmapv2.Polyline(
										{
											path : drawInfoArr,
											strokeColor : "#0000FF",
											strokeWeight : 6,
											map : map
										});
								resultInfoArr2
										.push(polyline_);
							}
						}//for문 [E]
					},
					error : function(request,
							status, error) {
						console
								.log("code:"
										+ request.status
										+ "\n"
										+ "message:"
										+ request.responseText
										+ "\n"
										+ "error:"
										+ error);
					}
				});
		});

		$(function(){
			var searchOption = $("#selectLevel").val();
			if(stopover2X != null){
				$
					.ajax({
						method : "POST",
						url : "https://apis.openapi.sk.com/tmap/truck/routes?version=1&format=json&callback=result",//
						async : false,
						data : {
							"appKey" : "l7xxce3558ee38884b2da0da786de609a5be",
							"startX" : stopover2X,
							"startY" : stopover2Y,
							"endX" : finishX,
							"endY" : finishY,
							"reqCoordType" : "WGS84GEO",
							"resCoordType" : "EPSG3857",
							"angle" : "172",
							"searchOption" : searchOption,
							"trafficInfo" : "Y",
							"truckType" : "1",
							"truckWidth" : "100",
							"truckHeight" : "100",
							"truckWeight" : "35000",
							"truckTotalWeight" : "35000",
							"truckLength" : "200"
						},
						success : function(response) {
							// 결과 출력
							var resultData = response.features;

							var tDistance = "총 거리 : "
									+ (resultData[0].properties.totalDistance / 1000)
											.toFixed(1)
									+ "km,";
							var tTime = " 총 시간 : "
									+ (resultData[0].properties.totalTime / 60)
											.toFixed(0)
									+ "분,";
							var tFare = " 총 요금 : "
									+ resultData[0].properties.totalFare
									+ "원,";
							var taxiFare = " 예상 택시 요금 : "
									+ resultData[0].properties.taxiFare
									+ "원";

							$("#result")
									.html();

							if (resultInfoArr3.length > 0) {
								for (var k = 0; k < resultInfoArr3.length; k++) {
									resultInfoArr2[k]
											.setMap(null);
								}
							}
							resultInfoArr3 = [];

							for ( var i in resultData) { //for문 [S]
								var geometry = resultData[i].geometry;
								var properties = resultData[i].properties;
								var polyline_;

								drawInfoArr = [];

								if (geometry.type == "LineString") {
									for ( var j in geometry.coordinates) {
										// 경로들의 결과값(구간)들을 포인트 객체로 변환 
										var latlng = new Tmapv2.Point(
												geometry.coordinates[j][0],
												geometry.coordinates[j][1]);
										// 포인트 객체를 받아 좌표값으로 변환
										var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
												latlng);
										// 포인트객체의 정보로 좌표값 변환 객체로 저장
										var convertChange = new Tmapv2.LatLng(
												convertPoint._lat,
												convertPoint._lng);
										// 배열에 담기
										drawInfoArr
												.push(convertChange);
									}

									polyline_ = new Tmapv2.Polyline(
											{
												path : drawInfoArr,
												strokeColor : "#FF0000",
												strokeWeight : 6,
												map : map
											});
									resultInfoArr2
											.push(polyline_);
								}
							}//for문 [E]
						},
						error : function(request,
								status, error) {
							console
									.log("code:"
											+ request.status
											+ "\n"
											+ "message:"
											+ request.responseText
											+ "\n"
											+ "error:"
											+ error);
						}
					});
			};		
		})
							
		//맵 중심영역 재설정
		var mapBoundInfo = map.getBounds();
		map.fitBounds(mapBoundInfo, 50);
	}

	function addComma(num) {
		var regexp = /\B(?=(\d{3})+(?!\d))/g;
		return num.toString().replace(regexp, ',');
	}
</script>
</head>
<body onload="initTmap();">
	<div class="ft_area" style="width: 940px;">
	</div>

	<div id="map_wrap" class="map_wrap">
		<div id="map_div"></div>
	</div>
	<div class="map_act_btn_wrap clear_box"></div>
	<p id="result"></p>
</body>
</html>